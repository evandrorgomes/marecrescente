ALTER TABLE MODRED.VALOR_GENOTIPO_DOADOR 
ADD (VAGD_IN_DIVERGENTE NUMBER );

COMMENT ON COLUMN MODRED.VALOR_GENOTIPO_DOADOR.VAGD_IN_DIVERGENTE IS 'Identifica o valor como sendo divergente ou não';


ALTER TABLE MODRED.LOCUS_EXAME 
ADD (LOEX_IN_PRIMEIRO_DIVERGENTE NUMBER );

ALTER TABLE MODRED.LOCUS_EXAME 
ADD (LOEX_IN_SEGUNDO_DIVERGENTE NUMBER );

COMMENT ON COLUMN MODRED.LOCUS_EXAME.LOEX_IN_PRIMEIRO_DIVERGENTE IS 'Identifica o primeiro alelo como divergente ou não';

COMMENT ON COLUMN MODRED.LOCUS_EXAME.LOEX_IN_SEGUNDO_DIVERGENTE IS 'Identifica o segundo alelo como divergente ou não';



ALTER TABLE MODRED.VALOR_GENOTIPO_PACIENTE 
ADD (VAGP_IN_DIVERGENTE NUMBER );

COMMENT ON COLUMN VALOR_GENOTIPO_PACIENTE.VAGP_IN_DIVERGENTE IS 'Identifica o valor como sendo divergente ou não';


INSERT INTO "MODRED"."TIPO_BUSCA_CHECKLIST" (TIBC_ID, TIBC_TX_DESCRICAO, TIBC_NR_AGE_DIAS) VALUES ('8', 'Discrepância genótipo', '2');
commit;


INSERT INTO "MODRED"."TIPO_TAREFA" (TITA_ID, TITA_TX_DESCRICAO, TITA_IN_AUTOMATICA, TARE_IN_SOMENTE_AGRUPADOR) VALUES ('94', 'RESOLVER_DISCREPANCIA_GENOTIPO', '0', '0');
COMMIT;


ALTER TABLE MODRED.LOCUS_EXAME_AUD 
ADD (LOEX_IN_PRIMEIRO_DIVERGENTE NUMBER );
delete from permissao where recu_id = 196;
ALTER TABLE MODRED.LOCUS_EXAME_AUD 
ADD (LOEX_IN_SEGUNDO_DIVERGENTE NUMBER );



ALTER TABLE METODOLOGIA 
ADD (METO_NR_PESO_GENOTIPO NUMBER );

COMMENT ON COLUMN METODOLOGIA.METO_NR_PESO_GENOTIPO IS 'Valor para pesar no momento da escolha em caso de empate em genótipo
';

INSERT INTO MODRED.PERMISSAO (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO) VALUES (44, 5, 0);
COMMIT;


ALTER TABLE MODRED.INSTRUCAO_COLETA 
ADD (INCO_IN_TIPO_INSTRUCAO VARCHAR2(5) );

COMMENT ON COLUMN MODRED.INSTRUCAO_COLETA.INCO_IN_TIPO_INSTRUCAO IS 'Flag que indica para qual finalidade a instrução deve ser aplicada. EXAME - Para pedido de exame e SWAB - para pedido de exame com swab.';

UPDATE MODRED.INSTRUCAO_COLETA SET inco_in_tipo_instrucao = 'EXAME';
COMMIT;



CREATE TABLE MODRED.ARQUIVO_RELAT_INTERNACIONAL 
(
  ARRI_ID NUMBER NOT NULL 
, BUSC_ID NUMBER NOT NULL 
, ARRI_TX_NOME_ARQUIVO VARCHAR2(150) 
, ARRI_TX_DESCRICAO_ARQUIVO VARCHAR2(255) 
, ARRI_TX_CAMINHO_ARQUIVO VARCHAR2(255) 
, CONSTRAINT PK_ARRI PRIMARY KEY 
  (
    ARRI_ID 
  )
  USING INDEX 
  (
      CREATE UNIQUE INDEX IN_PK_ARRI ON ARQUIVO_RELAT_INTERNACIONAL (ARRI_ID ASC) 
  )
  ENABLE 
);

CREATE INDEX IN_FK_ARRI_BUSC ON ARQUIVO_RELAT_INTERNACIONAL (BUSC_ID ASC);

ALTER TABLE MODRED.ARQUIVO_RELAT_INTERNACIONAL
ADD CONSTRAINT FK_ARRI_BUSC FOREIGN KEY
(
  BUSC_ID 
)
REFERENCES BUSCA
(
  BUSC_ID 
)
ENABLE;

COMMENT ON TABLE MODRED.ARQUIVO_RELAT_INTERNACIONAL IS 'Tabela para conter caminho dos arquivos de relatório de busca internacional para o analista de busca';

COMMENT ON COLUMN MODRED.ARQUIVO_RELAT_INTERNACIONAL.ARRI_ID IS 'Identificação do arquivo de relatório internacional';

COMMENT ON COLUMN MODRED.ARQUIVO_RELAT_INTERNACIONAL.BUSC_ID IS 'Identificação da busca';

COMMENT ON COLUMN MODRED.ARQUIVO_RELAT_INTERNACIONAL.ARRI_TX_NOME_ARQUIVO IS 'Nome do arquivo';

COMMENT ON COLUMN MODRED.ARQUIVO_RELAT_INTERNACIONAL.ARRI_TX_DESCRICAO_ARQUIVO IS 'Descrição do arquivo';

COMMENT ON COLUMN MODRED.ARQUIVO_RELAT_INTERNACIONAL.ARRI_TX_CAMINHO_ARQUIVO IS 'Caminho do arquivo';



CREATE SEQUENCE MODRED.SQ_ARRI_ID INCREMENT BY 1 MAXVALUE 9999999999999999999999999999 MINVALUE 1 CACHE 20;



INSERT INTO "MODRED"."CONFIGURACAO" (CONF_ID, CONF_TX_VALOR) VALUES ('extensaoArquivoRelatorioInternacional', 'application/pdf');
INSERT INTO "MODRED"."CONFIGURACAO" (CONF_ID, CONF_TX_VALOR) VALUES ('tamanhoArquivoRelatorioInternacionalEmByte', '5242880');
INSERT INTO "MODRED"."CONFIGURACAO" (CONF_ID, CONF_TX_VALOR) VALUES ('quantidadeArquivosRelatorioInternacional', '1');
INSERT INTO "MODRED"."RECURSO" (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO) VALUES ('194', 'CADASTRAR_ARQUIVO_RELATORIO_INTERNACIONAL', 'Permite cadastrar um novo arquivo de relatorio internacional');
commit;



ALTER TABLE MODRED.ARQUIVO_RELAT_INTERNACIONAL 
DROP COLUMN ARRI_TX_NOME_ARQUIVO;


INSERT INTO MODRED.RECURSO (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO) 
VALUES (195, 'LISTAR_ARQUIVOS_RELATORIO_BUSCA_INTERNACIONAL', 'Permite listar os arquivos de relatório internacional.');  
INSERT INTO MODRED.RECURSO (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO) 
VALUES (196, 'EXCLUIR_ARQUIVO_RELATORIO_BUSCA_INTERNACIONAL', 'Permite excluir arquivo de relatório internacional.');  

INSERT INTO MODRED.PERMISSAO (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO) 
VALUES (194, 5, 0);
INSERT INTO MODRED.PERMISSAO (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO) 
VALUES (195, 5, 0);
INSERT INTO MODRED.PERMISSAO (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO) 
VALUES (195, 1, 0);
INSERT INTO MODRED.PERMISSAO (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO) 
VALUES (196, 5, 0);
COMMIT;


INSERT INTO "MODRED"."TIPO_EXAME" (TIEX_ID,TIEX_TX_DESCRICAO) VALUES (5,'TESTE CONFIRMATÓRIO SWAB');
COMMIT;


INSERT INTO "MODRED"."TIPO_EXAME_LOCUS" (LOCU_ID,TIEX_ID) VALUES ('A','5');
INSERT INTO "MODRED"."TIPO_EXAME_LOCUS" (LOCU_ID,TIEX_ID) VALUES ('B','5');
INSERT INTO "MODRED"."TIPO_EXAME_LOCUS" (LOCU_ID,TIEX_ID) VALUES ('C','5');
INSERT INTO "MODRED"."TIPO_EXAME_LOCUS" (LOCU_ID,TIEX_ID) VALUES ('DQB1','5');
INSERT INTO "MODRED"."TIPO_EXAME_LOCUS" (LOCU_ID,TIEX_ID) VALUES ('DRB1','5');

COMMIT;


ALTER TABLE MODRED.TRANSPORTADORA 
ADD (TRAN_ATIVO NUMBER DEFAULT 1 NOT NULL);

COMMENT ON COLUMN TRANSPORTADORA.TRAN_ATIVO IS '1 para ativo e 0 para inativo';




INSERT INTO "MODRED"."RECURSO" (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO) VALUES ('197', 'EXCLUSAO_TRANSPORTADORA', 'Permite exclusão de uma transportadora.');
INSERT INTO "MODRED"."RECURSO" (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO) VALUES ('199', 'CONSULTAR_TRANSPORTADORA', 'Permite consultar transportadora.');
INSERT INTO "MODRED"."RECURSO" (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO) VALUES ('198', 'SALVAR_TRANSPORTADORA', 'Permite incluir e atualizar uma transportadora.');
commit;


INSERT INTO "MODRED"."PERMISSAO" (RECU_ID, PERF_ID) VALUES ('197', '17');
INSERT INTO "MODRED"."PERMISSAO" (RECU_ID, PERF_ID) VALUES ('198', '17');
INSERT INTO "MODRED"."PERMISSAO" (RECU_ID, PERF_ID) VALUES ('199', '17');
COMMIT;


INSERT INTO "MODRED"."PERMISSAO" (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO) VALUES ('197', '19', '0');
INSERT INTO "MODRED"."PERMISSAO" (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO) VALUES ('198', '19', '0');
INSERT INTO "MODRED"."PERMISSAO" (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO) VALUES ('199', '19', '0');
COMMIT;



ALTER TABLE MODRED.COURIER 
ADD (COUR_IN_ATIVO NUMBER DEFAULT 1 );

COMMENT ON COLUMN COURIER.COUR_IN_ATIVO IS '1 para ativo e 0 para inativo';


ALTER TABLE MODRED.LOCUS_EXAME
    ADD (LOEX_IN_INATIVO  NUMBER);
    
COMMENT ON COLUMN MODRED.LOCUS_EXAME.LOEX_IN_INATIVO IS 'Informa se o locus exame está ativo ou inativo.';

ALTER TABLE MODRED.LOCUS_EXAME_AUD
    ADD (LOEX_IN_INATIVO  NUMBER);
    
    
UPDATE MODRED.LOCUS_EXAME SET loex_in_inativo = 0;
COMMIT;

ALTER TABLE MODRED.LOCUS_EXAME  
MODIFY (LOEX_IN_INATIVO NOT NULL);

DELETE FROM MODRED.TAREFA WHERE TITA_ID = 94;
DELETE FROM MODRED.TIPO_TAREFA WHERE TITA_ID = 94;
COMMIT;


INSERT INTO "MODRED"."RECURSO" (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO) VALUES ('200', 'SALVAR_COURIER', 'Permite a inclusão e alteração de registros de courier');
INSERT INTO "MODRED"."RECURSO" (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO) VALUES ('201', 'CONSULTAR_COURIER', 'Permite a consulta de registros de courier');
INSERT INTO "MODRED"."RECURSO" (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO) VALUES ('202', 'INATIVAR_COURIER', 'Permite a exclusão lógica de couriers');
commit;

/*Foi dada permissao indevidamente para o perfil de transportadora para estas funcionalidades- Filipe Paes*/
DELETE FROM "MODRED"."PERMISSAO" WHERE RECU_ID = 197 AND PERF_ID = 17;
DELETE FROM "MODRED"."PERMISSAO" WHERE RECU_ID = 198 AND PERF_ID = 17;
DELETE FROM "MODRED"."PERMISSAO" WHERE RECU_ID = 199 AND PERF_ID = 17;
COMMIT;



INSERT INTO "MODRED"."PERMISSAO" (RECU_ID, PERF_ID) VALUES ('200', '17');
INSERT INTO "MODRED"."PERMISSAO" (RECU_ID, PERF_ID) VALUES ('201', '17');
INSERT INTO "MODRED"."PERMISSAO" (RECU_ID, PERF_ID) VALUES ('202', '17');
commit;

ALTER TABLE DOADOR 
DROP CONSTRAINT FK_DOAD_GEDO;

ALTER TABLE DOADOR 
DROP COLUMN GEDO_ID;

ALTER TABLE DOADOR_AUD
DROP COLUMN GEDO_ID;

ALTER TABLE GENOTIPO_DOADOR
ADD CONSTRAINT UK_GEDO_DOAD UNIQUE 
(
  DOAD_ID 
)
USING INDEX MODRED.IN_FK_GEDO_DOAD
ENABLE;


INSERT INTO MODRED.RECURSO (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO)
VALUES (203, 'VISUALIZAR_GENOTIPO_DIVERGENTE', 'Permite ao analista de busca visualizar o genótipo divergente.');
INSERT INTO MODRED.RECURSO (RECU_ID, RECU_TX_SIGLA, RECU_TX_DESCRICAO)
VALUES (204, 'DESCARTAR_LOCUS_EXAME', 'Permite ao analista de busca descarter um locus de um exame para resolver divergencias no genótipo.');
INSERT INTO MODRED.PERMISSAO (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO)
VALUES (203, 5, 0);
INSERT INTO MODRED.PERMISSAO (RECU_ID, PERF_ID, PERM_IN_COM_RESTRICAO)
VALUES (204, 5, 0);
COMMIT;


ALTER TABLE MODRED.SOLICITACAO 
ADD (SOLI_IN_RESOLVER_DIVERGENCIA NUMBER );

COMMENT ON COLUMN MODRED.SOLICITACAO.SOLI_IN_RESOLVER_DIVERGENCIA IS 'Flag que indica se a solicitação foi criada para resolver divergencia no genotipo.';

ALTER TABLE MODRED.PEDIDO_EXAME 
ADD (PEEX_DT_ABERTURA_DIVERGENCIA TIMESTAMP );

ALTER TABLE MODRED.PEDIDO_EXAME 
ADD (PEEX_DT_CONCLUSAO_DIVERGENCIA TIMESTAMP );

COMMENT ON COLUMN MODRED.PEDIDO_EXAME.PEEX_DT_ABERTURA_DIVERGENCIA IS 'Data de controle de pedido para resolver divergencia.';

COMMENT ON COLUMN MODRED.PEDIDO_EXAME.PEEX_DT_CONCLUSAO_DIVERGENCIA IS 'Data de controle de pedido para resolver divergencia.';


ALTER TABLE MODRED.PEDIDO_EXAME_AUD 
ADD (PEEX_DT_ABERTURA_DIVERGENCIA TIMESTAMP );

ALTER TABLE MODRED.PEDIDO_EXAME_AUD 
ADD (PEEX_DT_CONCLUSAO_DIVERGENCIA TIMESTAMP );


ALTER TABLE MODRED.LOCUS_EXAME 
ADD (LOEX_DT_MARCACAO_DIVERGENTE TIMESTAMP );

ALTER TABLE MODRED.LOCUS_EXAME 
ADD (LOEX_IN_MOTIVO_DIVERGENCIA NUMBER );

ALTER TABLE MODRED.LOCUS_EXAME 
ADD (LOEX_IN_SELECIONADO NUMBER );

ALTER TABLE MODRED.LOCUS_EXAME 
ADD (USUA_ID NUMBER );

COMMENT ON COLUMN MODRED.LOCUS_EXAME.LOEX_DT_MARCACAO_DIVERGENTE IS 'Informa a data que foi resolvido a divergencia deste locus.';
COMMENT ON COLUMN MODRED.LOCUS_EXAME.LOEX_IN_MOTIVO_DIVERGENCIA IS 'Informa o motivo da divergencia se foi 0 - por divegencia ou 1 - por empate.';
COMMENT ON COLUMN MODRED.LOCUS_EXAME.USUA_ID IS 'Identificação do usuário que inativou.';
COMMENT ON COLUMN MODRED.LOCUS_EXAME.LOEX_IN_SELECIONADO IS 'Informa que esse locus foi escolhido para ser usado no genótipo quando o motivo da  divergencia for Empate.';



ALTER TABLE MODRED.LOCUS_EXAME_AUD 
ADD (LOEX_DT_MARCACAO_DIVERGENTE TIMESTAMP );

ALTER TABLE MODRED.LOCUS_EXAME_AUD 
ADD (LOEX_IN_MOTIVO_DIVERGENCIA NUMBER );

ALTER TABLE MODRED.LOCUS_EXAME_AUD 
ADD (USUA_ID NUMBER );

ALTER TABLE MODRED.LOCUS_EXAME_AUD 
ADD (LOEX_IN_SELECIONADO NUMBER );


CREATE INDEX MODRED.IN_FK_LOEX_USUA ON MODRED.LOCUS_EXAME (USUA_ID);

ALTER TABLE MODRED.LOCUS_EXAME
ADD CONSTRAINT FK_LOEX_USUA FOREIGN KEY
(
  USUA_ID 
)
REFERENCES MODRED.USUARIO
(
  USUA_ID 
)
ENABLE;


